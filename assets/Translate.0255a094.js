import{b9 as T,bd as c,bg as g,bh as C,br as i,ap as E,E as A}from"./Circle.679b5c7b.js";import{P as u}from"./proj.6634b38d.js";const n={TRANSLATESTART:"translatestart",TRANSLATING:"translating",TRANSLATEEND:"translateend"};class l extends A{constructor(t,e,a,s,r){super(t),this.features=e,this.coordinate=a,this.startCoordinate=s,this.mapBrowserEvent=r}}class m extends T{constructor(t){t=t||{},super(t),this.on,this.once,this.un,this.lastCoordinate_=null,this.startCoordinate_=null,this.features_=t.features!==void 0?t.features:null;let e;if(t.layers&&!this.features_)if(typeof t.layers=="function")e=t.layers;else{const a=t.layers;e=function(s){return a.includes(s)}}else e=c;this.layerFilter_=e,this.filter_=t.filter&&!this.features_?t.filter:c,this.hitTolerance_=t.hitTolerance?t.hitTolerance:0,this.condition_=t.condition?t.condition:g,this.lastFeature_=null,this.addChangeListener(C.ACTIVE,this.handleActiveChanged_)}handleDownEvent(t){if(!t.originalEvent||!this.condition_(t))return!1;if(this.lastFeature_=this.featuresAtPixel_(t.pixel,t.map),!this.lastCoordinate_&&this.lastFeature_){this.startCoordinate_=t.coordinate,this.lastCoordinate_=t.coordinate,this.handleMoveEvent(t);const e=this.features_||new i([this.lastFeature_]);return this.dispatchEvent(new l(n.TRANSLATESTART,e,t.coordinate,this.startCoordinate_,t)),!0}return!1}handleUpEvent(t){if(this.lastCoordinate_){this.lastCoordinate_=null,this.handleMoveEvent(t);const e=this.features_||new i([this.lastFeature_]);return this.dispatchEvent(new l(n.TRANSLATEEND,e,t.coordinate,this.startCoordinate_,t)),this.startCoordinate_=null,!0}return!1}handleDragEvent(t){if(this.lastCoordinate_){const e=t.coordinate;t.map.getView().getProjection();const a=u(e),s=u(this.lastCoordinate_),r=a[0]-s[0],f=a[1]-s[1],o=this.features_||new i([this.lastFeature_]);o.forEach(function(h){const d=h.getGeometry();d.translate(r,f),h.setGeometry(d)}),this.lastCoordinate_=e,this.dispatchEvent(new l(n.TRANSLATING,o,e,this.startCoordinate_,t))}}handleMoveEvent(t){const e=t.map.getViewport();this.featuresAtPixel_(t.pixel,t.map)?(e.classList.remove(this.lastCoordinate_?"ol-grab":"ol-grabbing"),e.classList.add(this.lastCoordinate_?"ol-grabbing":"ol-grab")):e.classList.remove("ol-grab","ol-grabbing")}featuresAtPixel_(t,e){return e.forEachFeatureAtPixel(t,(a,s)=>{if(!(!(a instanceof E)||!this.filter_(a,s))&&!(this.features_&&!this.features_.getArray().includes(a)))return a},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_})}getHitTolerance(){return this.hitTolerance_}setHitTolerance(t){this.hitTolerance_=t}setMap(t){const e=this.getMap();super.setMap(t),this.updateState_(e)}handleActiveChanged_(){this.updateState_(null)}updateState_(t){let e=this.getMap();const a=this.getActive();(!e||!a)&&(e=e||t,e&&e.getViewport().classList.remove("ol-grab","ol-grabbing"))}}var w=m;export{w as T};
