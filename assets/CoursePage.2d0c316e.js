import{G as D}from"./proj.6634b38d.js";import{bO as V,bR as z,bX as U,c6 as W,an as $,be as Q,bx as d,bz as u,bA as w,bw as f,br as h,ap as c,b7 as m,aQ as X,ao as k,by as C,b9 as Y}from"./Circle.679b5c7b.js";import{T as g}from"./Translate.0255a094.js";import{l as q,o as J,e as K,f as N,g as Z}from"./index.8ff8d99e.js";const at={__name:"CoursePage",setup(j){class F extends c{constructor(t){super({name:"Buoy"}),this.type="Buoy",this.name=(t==null?void 0:t.name)||"Buoy",this.number=(t==null?void 0:t.number)||"0",this.color=(t==null?void 0:t.color)||"rgb(223,255,1)",this.radius=(t==null?void 0:t.radius)||5,this.coordinates=(t==null?void 0:t.coordinates)||[0,0];const e=new m(this.coordinates,this.radius);this.setGeometry(e)}getInteractions(t){const e=new g({hitTolerance:5,layers:[t],features:new h([this])});return e.on("translatestart",o=>{}),e.on("translateend",o=>{}),[e]}toObject(){return{type:this.type,name:this.name,number:this.number,color:this.color,radius:this.radius,coordinates:this.coordinates}}}class S{constructor(t){this.type="Gate",this.name=(t==null?void 0:t.name)||"Gate",this.number=(t==null?void 0:t.number)||"0",this.color=(t==null?void 0:t.color)||"rgb(223,255,1)",this.radius=(t==null?void 0:t.radius)||5,this.coordinates=(t==null?void 0:t.coordinates)||[[0,0],[0,0]],this.bouyA=new c({type:"Buoy",geometry:new m(this.coordinates[0],this.radius)}),this.bouyB=new c({props:{type:"Buoy"},geometry:new m(this.coordinates[1],this.radius)}),this.bouyB.setStyle(new f({fill:new d({color:this.color||"rgb(223,255,1)"}),stroke:new u({color:this.color||"rgb(223,255,1)",width:0,lineCap:"round"}),text:new w({text:String(this.number)+"b",font:"16px sans-serif",textAlign:"center",justify:"center"})}))}getInteractions(t){const e=new g({hitTolerance:5,layers:[t],features:new h([this.bouyA])});e.on("translatestart",i=>{}),e.on("translateend",i=>{});const o=new g({hitTolerance:5,layers:[t],features:new h([this.bouyB])});return o.on("translatestart",i=>{const s=this.bouyA.getGeometry().getCenter(),n=this.bouyB.getGeometry().getCenter();this.offset=[s[0]-n[0],s[1]-n[1]]}),o.on("translating",i=>{const s=this.bouyB.getGeometry().getCenter();this.bouyA.getGeometry().setCenter([s[0]+this.offset[0],s[1]+this.offset[1]])}),o.on("translateend",i=>{}),[e,o]}toObject(){return{type:this.type,name:this.name,number:this.number,color:this.color,radius:this.radius,coordinates:this.coordinates}}}class E{constructor(t){this.type="Startgate",this.name=(t==null?void 0:t.name)||"Startgate",this.number=(t==null?void 0:t.number)||"0",this.color=(t==null?void 0:t.color)||"rgb(223,255,1)",this.radius=(t==null?void 0:t.radius)||5,this.coordinates=(t==null?void 0:t.coordinates)||[[0,0],[0,0]],this.preventRotateEventPropagation=!1,this.currentCoordinate=[0,0],this.bouyA=new c({geometry:new m(this.coordinates[0],this.radius)}),this.bouyA.setStyle(new f({fill:new d({color:this.color||"rgb(223,255,1)"}),stroke:new u({color:this.color||"rgb(223,255,1)",width:0,lineCap:"round"}),text:new w({text:String(this.number)+"a",font:"16px sans-serif",textAlign:"center",justify:"center"})})),this.bouyB=new c({geometry:new m(this.coordinates[1],this.radius)}),this.bouyB.setStyle(new f({fill:new d({color:this.color||"rgb(223,255,1)"}),stroke:new u({color:this.color||"rgb(223,255,1)",width:0,lineCap:"round"}),text:new w({text:String(this.number)+"b",font:"16px sans-serif",textAlign:"center",justify:"center"})})),this.startLine=new c({geometry:new X([this.coordinates[1],this.coordinates[0]])}),this.startLine.setStyle(new f({fill:new d({color:this.color||"rgb( 255,0,0)"}),stroke:new u({color:this.color||"rgb( 255,0,0)",width:5,lineCap:"round",lineDash:[5,15]}),text:new w({text:this.name||"start",font:"16px sans-serif",textAlign:"center",justify:"center",offsetY:15})})),this.rotateHandel=new c({geometry:new k([this.coordinates[1][0]+20,this.coordinates[1][1]],1e-4)}),this.rotateHandel.setStyle(new f({fill:new d({color:"lightgrey"}),stroke:new u({color:"white",width:2,lineCap:"round"}),image:new C({color:"#BADA55",src:"icons/cycle_fill1_48px.svg",scale:.45,rotateWithView:!0})})),this.dragHandel=new c({geometry:new k([this.coordinates[1][0],this.coordinates[1][1]-20],1e-4)}),this.dragHandel.setStyle(new f({fill:new d({color:"lightgrey"}),stroke:new u({color:"white",width:2,lineCap:"round"}),image:new C({color:"#BADA55",src:"icons/drag_pan_fill1_48px.svg",scale:.45,rotateWithView:!0})}))}getInteractions(t,e){const o=new g({hitTolerance:5,layers:[t],features:new h([this.bouyA])});o.on("translatestart",a=>{}),o.on("translating",a=>{this.startLine.getGeometry().setCoordinates([this.bouyA.getGeometry().getCenter(),this.bouyB.getGeometry().getCenter()])}),o.on("translateend",a=>{});const i=new g({hitTolerance:5,layers:[t],features:new h([this.bouyB])});i.on("translatestart",a=>{i.features_=new h([this.bouyA,this.bouyB,this.startLine,this.dragHandel,this.rotateHandel])}),i.on("translateend",a=>{i.features_=new h([this.bouyB])});const s=new g({hitTolerance:5,layers:[t],features:new h([this.dragHandel])});s.on("translatestart",a=>{s.features_=e}),s.on("translateend",a=>{s.features_=new h([this.dragHandel])});const n=new Y({hitTolerance:10,layers:[t],features:new h([this.rotateHandel]),handleDownEvent:a=>{if(a.map.getFeaturesAtPixel(a.pixel,{hitTolerance:10}).indexOf(this.rotateHandel)>-1)return this.currentCoordinate=a.coordinate,this.preventRotateEventPropagation=!0,!0},stopDown:()=>this.preventRotateEventPropagation,handleDragEvent:a=>{const y=this.bouyB.getGeometry().getCenter(),T=this.currentCoordinate[0]-y[0],H=this.currentCoordinate[1]-y[1],L=Math.atan2(H,T),P=a.coordinate[0]-y[0],I=a.coordinate[1]-y[1],R=Math.atan2(I,P);e.getArray().forEach(M=>{M.getGeometry().rotate(R-L,y)}),this.currentCoordinate=a.coordinate},handleUpEvent:()=>{this.preventRotateEventPropagation=!1}});return[o,i,s,n]}toObject(){return{type:this.type,name:this.name,number:this.number,color:this.color,radius:this.radius,coordinates:this.coordinates}}}var x=D([10.932036344861501,49.124145352082735],"EPSG:4326","EPSG:3857");const A=q();var r=new V,b=new z({projection:"EPSG:3857",center:x,zoom:18});r.setView(b),r.addLayer(new U({source:new W}));const B=new $;var v=new Q({source:B});v.setStyle(l=>{if(l.type=="Buoy"){const e=new d({color:l.color||"rgb(223,255,1)"}),o=new u({color:l.color||"rgb(223,255,1)",width:0,lineCap:"round"});if(console.log(b.getResolution()),b.getResolution()<.7)var t=new w({text:String(l.number)||"",font:"16px sans-serif",textAlign:"center",justify:"center"});return new f({fill:e,stroke:o,text:t})}else console.log(l)}),r.addLayer(v);const _={name:"",description:"",centerofrotation:x,angleofrotation:45,marks:[{type:"Buoy",name:"",number:1,color:"",coordinates:null,offset:[0,100]},{type:"Gate",name:"Finish",number:3,color:"pink",offset:[[-20,-50],[20,-50]]},{type:"Startgate",name:"",number:1,color:"green",offset:[[-20,0],[20,0]]},{type:"Buoy",name:"",number:4,color:"",coordinates:null,offset:[0,-100]}]};class G{constructor(t,e,o){this.name="racecource",this.description="generic",this.centerofrotation=o,this.angleofrotation=45,this.marks=new h,this.map=e,this.racecource=t,this.courseFeatures=new h}addMark(t,e){var o,i,s;if(e.type=="Buoy"){t.centerofrotation&&e.offset&&(e.coordinates=[],e.coordinates[0]=t.centerofrotation[0]+e.offset[0],e.coordinates[1]=t.centerofrotation[1]+e.offset[1]);const n=new F(e);this.marks.push(n),this.courseFeatures.push(n),(o=n.getInteractions())==null||o.forEach(a=>{r.addInteraction(a)}),this.racecource.addFeature(n)}if(e.type=="Gate"){t.centerofrotation&&e.offset&&(e.coordinates=[[0,0],[0,0]],e.coordinates[0]=[t.centerofrotation[0]+e.offset[0][0],t.centerofrotation[1]+e.offset[0][1]],e.coordinates[1]=[t.centerofrotation[0]+e.offset[1][0],t.centerofrotation[1]+e.offset[1][1]]);const n=new S(e);this.marks.push(n),this.courseFeatures.push(n.bouyA),this.courseFeatures.push(n.bouyB),this.racecource.addFeature(n.bouyA),this.racecource.addFeature(n.bouyB),(i=n.getInteractions(this.racecource))==null||i.forEach(a=>{r.addInteraction(a)})}if(e.type=="Startgate"){t.centerofrotation&&e.offset&&(e.coordinates=[[0,0],[0,0]],e.coordinates[0]=[t.centerofrotation[0]+e.offset[0][0],t.centerofrotation[1]+e.offset[0][1]],e.coordinates[1]=[t.centerofrotation[0]+e.offset[1][0],t.centerofrotation[1]+e.offset[1][1]]);const n=new E(e);this.marks.push(n),this.courseFeatures.push(n.bouyA),this.courseFeatures.push(n.bouyB),this.courseFeatures.push(n.startLine),this.courseFeatures.push(n.dragHandel),this.courseFeatures.push(n.rotateHandel),this.racecource.addFeature(n.bouyA),this.racecource.addFeature(n.bouyB),this.racecource.addFeature(n.startLine),this.racecource.addFeature(n.dragHandel),this.racecource.addFeature(n.rotateHandel),(s=n.getInteractions(this.racecource,this.courseFeatures))==null||s.forEach(a=>{r.addInteraction(a)})}}load(t){t.marks.forEach(e=>{this.addMark(t,e)})}toObject(){const t={name:this.name,description:this.description,centerofrotation:this.centerofrotation,angleofrotation:this.angleofrotation,marks:[]};return this.marks.forEach(e=>{t.marks.push(e.toObject())}),t}}return new G(B,r).load(_),J(()=>{r==null||r.setTarget(A.value)}),K(()=>{r==null||r.setTarget(void 0),r=void 0}),(l,t)=>(N(),Z("div",{id:"map",ref_key:"mapRef",ref:A,style:{height:"800px",width:"800px"}},null,512))}};export{at as default};
